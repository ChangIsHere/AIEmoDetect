{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// 移除显式导入，uni对象在UniApp环境中为全局对象\n\n/**\n * 请求工具模块\n */\n\n// API基础URL，直接指向LLM服务\nconst BASE_URL = 'https://git.yukexx.com';\n\nconst request = (options) => {\n\tconst { url, method, data, headers } = options;\n\n\tconsole.log('Request URL:', url); // 打印请求URL\n\tconsole.log('Request Data:', data); // 打印请求数据\n\tconsole.log('Request Headers:', headers); // 打印请求头\n\n\treturn new Promise((resolve, reject) => {\n\t\tuni.request({\n\t\t\turl: url,\n\t\t\tmethod: method || 'POST',\n\t\t\tdata: data,\n\t\t\theader: headers, // 直接使用传入的headers\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.statusCode === 200) {\n\t\t\t\t\tresolve(res.data);\n\t\t\t\t} else {\n\t\t\t\t\treject(res.data || { message: `请求失败，状态码: ${res.statusCode}` });\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('Network request failed:', err);\n\t\t\t\treject({ message: '网络请求失败，请检查网络连接', detail: err });\n\t\t\t},\n\t\t});\n\t});\n};\n\nconst chatWithLLM = (params) => {\n\treturn request({\n\t\turl: `${BASE_URL}/chat/text`,\n\t\tmethod: 'POST',\n\t\tdata: {\n\t\t\tquestion: params.message,\n\t\t\tsession_id: params.sessionId,\n\t\t},\n\t\theaders: {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t},\n\t});\n};\n\nconst uploadVideoForAnalysis = (options) => {\n\tconst {\n\t\tfilePath,\n\t\ttaskType = 'emotion_analysis',\n\t\tdetailsLevel = 'high',\n\t\tquestion = '分析视频中人物的情感，并且给出详细原因',\n\t\tmaxFrames = 100\n\t} = options;\n\n\treturn new Promise((resolve, reject) => {\n\t\tuni.uploadFile({\n\t\t\turl: `${BASE_URL}/analyze/video`,\n\t\t\tfilePath: filePath,\n\t\t\tname: 'file',\n\t\t\tformData: {\n\t\t\t\t'task_type': taskType,\n\t\t\t\t'details_level': detailsLevel,\n\t\t\t\t'question': question,\n\t\t\t\t'max_frames': maxFrames\n\t\t\t},\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.statusCode === 200) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst data = JSON.parse(res.data);\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\treject({ message: '视频分析接口返回数据解析失败', detail: res.data, error: err });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treject({ message: `上传失败: ${res.statusCode}`, statusCode: res.statusCode });\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\treject({ message: '视频分析请求失败', error: err });\n\t\t\t},\n\t\t});\n\t});\n};\n\nexport default {\n\tchatWithLLM,\n\tuploadVideoForAnalysis,\n}; "],"names":["uni"],"mappings":";;AAOA,MAAM,WAAW;AAEjB,MAAM,UAAU,CAAC,YAAY;AAC5B,QAAM,EAAE,KAAK,QAAQ,MAAM,QAAO,IAAK;AAEvCA,gBAAY,MAAA,MAAA,OAAA,0BAAA,gBAAgB,GAAG;AAC/BA,gBAAY,MAAA,MAAA,OAAA,0BAAA,iBAAiB,IAAI;AACjCA,6DAAY,oBAAoB,OAAO;AAEvC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,QAAQ;AAAA,MACX;AAAA,MACA,QAAQ,UAAU;AAAA,MAClB;AAAA,MACA,QAAQ;AAAA;AAAA,MACR,SAAS,CAAC,QAAQ;AACjB,YAAI,IAAI,eAAe,KAAK;AAC3B,kBAAQ,IAAI,IAAI;AAAA,QACrB,OAAW;AACN,iBAAO,IAAI,QAAQ,EAAE,SAAS,aAAa,IAAI,UAAU,GAAE,CAAE;AAAA,QAC7D;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACdA,sBAAA,MAAA,MAAA,SAAA,0BAAc,2BAA2B,GAAG;AAC5C,eAAO,EAAE,SAAS,kBAAkB,QAAQ,IAAK,CAAA;AAAA,MACjD;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAEA,MAAM,cAAc,CAAC,WAAW;AAC/B,SAAO,QAAQ;AAAA,IACd,KAAK,GAAG,QAAQ;AAAA,IAChB,QAAQ;AAAA,IACR,MAAM;AAAA,MACL,UAAU,OAAO;AAAA,MACjB,YAAY,OAAO;AAAA,IACnB;AAAA,IACD,SAAS;AAAA,MACR,gBAAgB;AAAA,IAChB;AAAA,EACH,CAAE;AACF;AAEA,MAAM,yBAAyB,CAAC,YAAY;AAC3C,QAAM;AAAA,IACL;AAAA,IACA,WAAW;AAAA,IACX,eAAe;AAAA,IACf,WAAW;AAAA,IACX,YAAY;AAAA,EACZ,IAAG;AAEJ,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,WAAW;AAAA,MACd,KAAK,GAAG,QAAQ;AAAA,MAChB;AAAA,MACA,MAAM;AAAA,MACN,UAAU;AAAA,QACT,aAAa;AAAA,QACb,iBAAiB;AAAA,QACjB,YAAY;AAAA,QACZ,cAAc;AAAA,MACd;AAAA,MACD,SAAS,CAAC,QAAQ;AACjB,YAAI,IAAI,eAAe,KAAK;AAC3B,cAAI;AACH,kBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,oBAAQ,IAAI;AAAA,UACZ,SAAQ,KAAK;AACb,mBAAO,EAAE,SAAS,kBAAkB,QAAQ,IAAI,MAAM,OAAO,IAAG,CAAE;AAAA,UAClE;AAAA,QACN,OAAW;AACN,iBAAO,EAAE,SAAS,SAAS,IAAI,UAAU,IAAI,YAAY,IAAI,WAAY,CAAA;AAAA,QACzE;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACd,eAAO,EAAE,SAAS,YAAY,OAAO,IAAK,CAAA;AAAA,MAC1C;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAEA,MAAe,YAAA;AAAA,EACd;AAAA,EACA;AACD;;"}