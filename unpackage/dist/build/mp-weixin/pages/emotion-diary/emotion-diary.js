"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}const t=e.defineComponent({__name:"emotion-diary",setup(t){const n=e.ref(""),o=e.ref(0),a=e.ref([]),l=e.ref(""),i=e.ref([]),r=e.computed((()=>{if(0===o.value)return"请选择心情评分";return["非常差","有点差","一般","比较好","非常好"][o.value-1]})),u=e.computed((()=>[...a.value].sort(((e,t)=>new Date(t.date)-new Date(e.date)))));function s(){return e.__awaiter(this,void 0,void 0,(function*(){if(!n.value||0===o.value)return e.index.showToast({title:"请填写日记内容并选择心情评分",icon:"none",duration:2e3}),Promise.resolve(null);const t=new UTSJSONObject({id:Date.now(),date:(new Date).toISOString().split("T")[0],content:n.value,rating:o.value});try{let l=[];try{const t=yield e.index.getStorage({key:"emotionDiaryEntries"});t.data&&(l=UTS.JSON.parse(t.data))}catch(a){console.log("No existing emotion diary entries found.")}l.push(t),yield e.index.setStorage({key:"emotionDiaryEntries",data:UTS.JSON.stringify(l)}),console.log("日记已保存:",t),e.index.showToast({title:"日记保存成功！",icon:"success",duration:2e3}),n.value="",o.value=0,c()}catch(l){console.error("日记保存失败:",l),e.index.showToast({title:"日记保存失败",icon:"error",duration:2e3})}}))}function c(){return e.__awaiter(this,void 0,void 0,(function*(){try{const t=yield e.index.getStorage({key:"emotionDiaryEntries"});t.data&&(a.value=UTS.JSON.parse(t.data),console.log("Loaded diary entries:",a.value),g(),d())}catch(t){console.log("No emotion diary entries found."),a.value=[],i.value=[],g()}}))}function d(){console.log("Chart rendering logic would go here.");const e=new UTSJSONObject({categories:[],series:[new UTSJSONObject({name:"心情评分",data:[]})]}),t=new Date;t.setDate(t.getDate()-6);a.value.filter((e=>new Date(e.date)>=t)).sort(((e,t)=>new Date(e.date)-new Date(t.date))).forEach((t=>{e.categories.push(t.date),e.series[0].data.push(t.rating)})),e.categories.length>0&&console.log("Chart data prepared:",e)}function g(){return e.__awaiter(this,void 0,void 0,(function*(){if(0===a.value.length)return i.value.push({id:Date.now(),role:"ai",text:"您还没有记录任何日记，快去写下第一篇日记吧！"}),Promise.resolve(null);const e=a.value.slice(-7).map((e=>e.rating)),t=e.reduce(((e,t)=>e+t),0)/e.length;let n="根据您最近的心情记录，";n+=t>=4?"您的情绪状况非常好，请继续保持积极乐观的心态！":t>=3?"您的情绪状况总体良好，可以尝试更多积极的活动来提升心情。":t>=2?"您的情绪状况近期可能有些波动，请多关注自己的感受，尝试放松练习或与朋友交流。":"您的情绪状况可能有些低落，请不要独自承受，可以尝试深呼吸练习或寻求专业帮助。",i.value.push({id:Date.now()+1,role:"ai",text:n})}))}function v(){return e.__awaiter(this,void 0,void 0,(function*(){if(!l.value.trim())return Promise.resolve(null);const e=l.value.trim();i.value.push({id:Date.now(),role:"user",text:e}),l.value="";const t=`您好！您刚才提到了：“${e}”。我是一个AI助手，目前还无法直接连接到大型语言模型进行实时对话。但是，我很乐意为您提供一些通用的鼓励或建议。`;i.value.push({id:Date.now()+1,role:"ai",text:t})}))}function f(){console.log("Exit Emotion Diary button clicked. Switching tab to pages/pages3/pages3"),e.index.switchTab({url:"/pages/pages3/pages3"})}return e.onLoad((()=>{console.log("Emotion Diary Page: onLoad triggered."),c()})),e.onMounted((()=>{console.log("Emotion Diary Page: onMounted triggered."),d()})),e.onUnmounted((()=>{console.log("onUnmounted called for Emotion Diary page")})),(t=null,a=null)=>e.e(new UTSJSONObject({a:e.f(5,((t=null,n=null,a=null)=>new UTSJSONObject({a:e.t(t),b:t,c:e.n(new UTSJSONObject({selected:o.value>=t})),d:e.o(((e=null)=>function(e=null){o.value=e,console.log(`Selected rating: ${e}`)}(t)),t)}))),b:e.t(r.value),c:n.value,d:e.o(((e=null)=>n.value=e.detail.value)),e:e.p(new UTSJSONObject({type:"upload-filled",size:"24",color:"#fff"})),f:e.o(s),g:e.sei("emotionChart","canvas"),h:e.f(u.value,((t=null,n=null,o=null)=>new UTSJSONObject({a:e.t(t.date),b:e.t(t.rating),c:e.t(t.content),d:t.id}))),i:0===u.value.length}),(u.value.length,new UTSJSONObject({})),new UTSJSONObject({j:e.f(i.value,((t=null,n=null,o=null)=>new UTSJSONObject({a:e.t(t.text),b:t.id,c:e.n(t.role)}))),k:e.o(v),l:l.value,m:e.o(((e=null)=>l.value=e.detail.value)),n:e.p(new UTSJSONObject({type:"paperplane-filled",size:"24",color:"#fff"})),o:e.o(v),p:e.p(new UTSJSONObject({type:"undo-alt",size:"24",color:"#fff"})),q:e.o(f),r:e.sei(e.gei(t,""),"view")}))}}),n=e._export_sfc(t,[["__scopeId","data-v-f13780e7"]]);wx.createPage(n);
