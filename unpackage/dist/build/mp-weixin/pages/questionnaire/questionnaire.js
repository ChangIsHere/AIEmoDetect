"use strict";const e=require("../../common/vendor.js"),t=e.defineComponent({__name:"questionnaire",setup(t){const n=e.ref(""),a=e.ref(""),i=e.ref(0),l=e.ref(new UTSJSONObject({})),o=[new UTSJSONObject({id:1,text:"我感觉很难让自己安静下来"}),new UTSJSONObject({id:2,text:"我感到口干"}),new UTSJSONObject({id:3,text:"我好像不能再有任何愉快、舒畅的感觉"}),new UTSJSONObject({id:4,text:"我感到呼吸困难(例如不是做运动时也感到气促或透不过气来)"}),new UTSJSONObject({id:5,text:"我感到很难自动去开始工作"}),new UTSJSONObject({id:6,text:"我对事情往往作出过敏反应"}),new UTSJSONObject({id:7,text:"我感到颤抖(例如手震)"}),new UTSJSONObject({id:8,text:"我觉得自己消耗很多精神"}),new UTSJSONObject({id:9,text:"我忧虑一些自己恐慌或出丑的场合"}),new UTSJSONObject({id:10,text:"我觉得自己对将来没有甚么可盼望"}),new UTSJSONObject({id:11,text:"我感到忐忑不安"}),new UTSJSONObject({id:12,text:"我感到很难放松自己"}),new UTSJSONObject({id:13,text:"我感到忧 沮丧"}),new UTSJSONObject({id:14,text:"我无法容忍任何阻碍我继续作的事情"}),new UTSJSONObject({id:15,text:"我感到快要恐慌了"}),new UTSJSONObject({id:16,text:"我对任何事也不能热衷"}),new UTSJSONObject({id:17,text:"我觉得自己不怎么配做人"}),new UTSJSONObject({id:18,text:"我发觉自己很容易被触怒"}),new UTSJSONObject({id:19,text:"我察觉自己没有明显的体力劳动时，也感到心律不正常"}),new UTSJSONObject({id:20,text:"我无缘无故地感到害怕"}),new UTSJSONObject({id:21,text:"我感到生命毫无意义"})],c=[new UTSJSONObject({id:1,text:"做事情几乎没有兴趣或乐趣"}),new UTSJSONObject({id:2,text:"感到情绪低落，沮丧或绝望"}),new UTSJSONObject({id:3,text:"难以入睡或保持睡眠，或睡得太多"}),new UTSJSONObject({id:4,text:"感到疲倦或没有精力"}),new UTSJSONObject({id:5,text:"食欲不振或暴饮暴食"}),new UTSJSONObject({id:6,text:"对自己感到不好，或觉得自己是个失败者，或让自己或家人失望"}),new UTSJSONObject({id:7,text:"难以集中注意力，例如阅读报纸或看电视"}),new UTSJSONObject({id:8,text:"行动或说话缓慢，以至于其他人可能注意到，或者相反—坐立不安或烦躁不安，比平时动得更多"}),new UTSJSONObject({id:9,text:"觉得自己死了会更好，或想伤害自己的念头"})],S=[new UTSJSONObject({value:0,text:"不适用"}),new UTSJSONObject({value:1,text:"很适用，或经常适用"}),new UTSJSONObject({value:2,text:"非常适用"}),new UTSJSONObject({value:3,text:"最适用"})],u=[new UTSJSONObject({value:0,text:"完全没有"}),new UTSJSONObject({value:1,text:"几天"}),new UTSJSONObject({value:2,text:"一半以上日子"}),new UTSJSONObject({value:3,text:"几乎每天"})],O=e.computed((()=>"DASS21"===a.value?o:"PHQ9"===a.value?c:[])),d=e.computed((()=>"DASS21"===a.value?S:"PHQ9"===a.value?u:[])),s=e.computed((()=>O.value[i.value]));function v(){if(void 0===l.value[s.value.id])return e.index.showToast({title:"请选择一个答案",icon:"none"}),null;i.value<O.value.length-1?(i.value++,w()):function(){e.__awaiter(this,void 0,void 0,(function*(){if(void 0===l.value[s.value.id])return e.index.showToast({title:"请选择一个答案",icon:"none"}),Promise.resolve(null);if(!O.value.every((e=>void 0!==l.value[e.id])))return e.index.showToast({title:"请回答所有题目",icon:"none",duration:2e3}),Promise.resolve(null);const t=new UTSJSONObject({scaleType:a.value,timestamp:Date.now(),answers:l.value,totalScore:Object.values(l.value).reduce(((e=null,t=null)=>e+t),0)});try{yield e.index.setStorage({key:`scaleResult_${t.scaleType}_${t.timestamp}`,data:UTS.JSON.stringify(t)}),console.log("量表结果已存储:",t),e.index.showToast({title:"测评完成，结果已保存",icon:"success",duration:2e3}),e.index.removeStorage({key:`scaleProgress_${a.value}`}),e.index.navigateTo({url:`/pages/emotion-result/emotion-result?scaleType=${t.scaleType}&timestamp=${t.timestamp}`,success:function(e){e.eventChannel.emit("acceptResultDataFromOpenerPage",new UTSJSONObject({data:t}))}})}catch(n){console.error("量表结果保存或跳转失败:",n),e.index.showToast({title:"结果处理失败",icon:"error",duration:2e3})}}))}()}function r(){i.value>0&&(i.value--,w())}function w(){return e.__awaiter(this,void 0,void 0,(function*(){const t=`scaleProgress_${a.value}`,n=new UTSJSONObject({questionIndex:i.value,answers:l.value});try{yield e.index.setStorage({key:t,data:UTS.JSON.stringify(n)}),console.log("进度已保存:",n)}catch(o){console.error("进度保存失败:",o)}}))}function T(){return e.__awaiter(this,void 0,void 0,(function*(){yield w(),e.index.showToast({title:"进度已保存，返回列表",icon:"none",duration:1500}),e.index.navigateBack()}))}return e.onLoad((t=>{t.scaleType?(a.value=t.scaleType,"DASS21"===a.value?n.value="抑郁-焦虑-压力量表 (DASS-21)":"PHQ9"===a.value&&(n.value="抑郁症状评估量表 (PHQ-9)"),function(){e.__awaiter(this,void 0,void 0,(function*(){const t=`scaleProgress_${a.value}`;try{const n=yield e.index.getStorage({key:t});if(n.data){const t=UTS.JSON.parse(n.data);i.value=t.questionIndex,l.value=t.answers,e.index.showToast({title:"已加载上次进度",icon:"none"})}}catch(n){console.warn("无上次进度或加载失败:",n)}}))}()):e.index.showToast({title:"量表类型未指定",icon:"error"})})),(t=null,a=null)=>e.e(new UTSJSONObject({a:e.t(n.value),b:e.t(i.value+1),c:e.t(O.value.length),d:s.value}),s.value?new UTSJSONObject({e:e.t(s.value.id),f:e.t(s.value.text),g:e.f(d.value,((t=null,n=null,a=null)=>new UTSJSONObject({a:e.t(t.value),b:e.t(t.text),c:t.value,d:e.n(new UTSJSONObject({selected:l.value[s.value.id]===t.value})),e:e.o(((e=null)=>function(e=null,t=null){l.value[e]=t,w()}(s.value.id,t.value)),t.value)}))),h:0===i.value,i:e.o(r),j:e.t(i.value===O.value.length-1?"提交":"下一题"),k:e.o(v),l:e.o(T)}):new UTSJSONObject({}),new UTSJSONObject({m:e.sei(e.gei(t,""),"view")}))}}),n=e._export_sfc(t,[["__scopeId","data-v-93d6178d"]]);wx.createPage(n);
