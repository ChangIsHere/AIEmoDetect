		<!-- 8.11 -->
<template>
  <view class="container">
		<!-- é¡¶éƒ¨æ¸©é¦¨æ¬¢è¿åŒº -->
		<view class="welcome-header">
			<view class="welcome-card">
				<view class="welcome-icon">ğŸŒˆ</view>
				<view class="welcome-texts">
					<text class="welcome-title">Hiï¼Œæˆ‘æ˜¯Anoï¼Œä½ çš„å¿ƒç†å¥åº·åŠ©æ‰‹</text>
					<text class="welcome-tip">æ¬¢è¿æ¥åˆ°ä½ è‡ªå·±çš„æƒ…æ„Ÿå®‡å®™</text>
				</view>
			</view>
		</view>

		<!-- ç²’å­æ•ˆæœå±‚ -->
		<view class="particles">
			<view v-for="i in 20" :key="i" class="particle"></view>
		</view>

		<view class="top-section">
			<view class="face-container">
				<view class="eye"></view>
				<view class="eye"></view>
			</view>
		</view>

		<!-- èŠå¤©åŒºå¡ç‰‡ -->
		<view class="chat-card">
			<scroll-view class="chat-box" scroll-y="true" :scroll-top="scrollTop" :scroll-with-animation="true">
				<view class="ai-message" style="animation-duration: 0.3s">
					<view class="chat-message">ä½ å¥½ï¼ä½ ä»Šå¤©è¿‡çš„è¿˜å¥½å—ï¼Ÿæˆ–è®¸ä½ çš„å¿ƒæƒ…éš¾ä»¥ç”¨è¨€è¯­å½¢å®¹ï¼Œé‚£è®©æˆ‘æ¥ç»™ä½ åšä¸€ä¸ªå¿ƒç†æ£€æµ‹æ€ä¹ˆæ ·ï¼</view>
				</view>
				<view v-for="(message, index) in messages" :key="message.id" :class="message.type === 'user' ? 'user-message' : 'ai-message'">
					<view class="chat-message">{{ message.content }}</view>
				</view>
				<view v-if="loading" class="ai-message loading-message">
					<view class="loading-dots">
						<view class="dot"></view>
						<view class="dot"></view>
						<view class="dot"></view>
					</view>
				</view>
			</scroll-view>
		</view>

		<!-- è¾“å…¥åŒºå¡ç‰‡ -->
		<view class="input-card">
			<view class="input-inner">
				<input class="chat-input" type="text" v-model="userInput" @click="handleInputClick" confirm-type="send" @confirm="handleSend" :disabled="loading" />
				<view class="send-button" @tap="handleSend" :class="{ 'disabled': loading }">å‘é€</view>
			</view>
		</view>
		
		<!-- æƒ…ç»ªæ£€æµ‹æ¨èå¼¹çª— -->
		<view v-if="showEmotionModal" class="emotion-modal" @touchmove.stop.prevent>
			<view class="emotion-modal-content">
				<view class="modal-close" @tap="closeEmotionModal">Ã—</view>
				<view class="modal-header">
					<text class="modal-title">AIæƒ…ç»ªåˆ†æ</text>
				</view>
				<view class="modal-body">
					<text class="modal-text">é€šè¿‡åˆ†ææ‚¨çš„å¯¹è¯ï¼Œæˆ‘ä»¬å‘ç°æ‚¨æœ€è¿‘çš„æƒ…ç»ªå¯èƒ½æ³¢åŠ¨è¾ƒå¤§ã€‚</text>
					<text class="modal-text">æƒ³è¦è¿›è¡Œæ›´ç²¾ç¡®çš„æƒ…ç»ªåˆ†æå—ï¼Ÿ</text>
					<text class="modal-description">æˆ‘ä»¬å°†é€šè¿‡è¯­éŸ³å’Œé¢éƒ¨è¡¨æƒ…æ¥ç»¼åˆè¯„ä¼°æ‚¨çš„æƒ…ç»ªçŠ¶æ€ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°äº†è§£è‡ªå·±ã€‚</text>
					<view class="modal-icon">
						<view class="pulse-circle"></view>
					</view>
				</view>
				<view class="modal-footer">
					<view class="modal-button cancel" @tap="closeEmotionModal">ç¨åå†è¯´</view>
					<view class="modal-button primary" @tap="startEmotionDetection">ç«‹å³æ£€æµ‹</view>
				</view>
			</view>
    </view>
    <!-- åº•éƒ¨éšç§è¯´æ˜å¡ç‰‡ -->
    <view class="privacy-footer-card">
      <text class="privacy-icon">ğŸ”’</text>
      <text class="privacy-text">ä½ çš„ç§˜å¯†ï¼ŒAIå®‰å…¨å®ˆæŠ¤ï¼ŒèŠå¤©å†…å®¹ç»ä¸å¤–æ³„ï¼ğŸ¤«</text>
    </view>
    <!-- å³ä¸‹è§’æ‚¬æµ®è®¾ç½®æŒ‰é’® -->
    <view class="fab-setting" @tap="onSettingTap">
      <text class="fab-icon">âš™ï¸</text>
    </view>
  </view>
</template>

<script>
const negativeKeywords = [
  "éš¾å—", "å¿ƒæƒ…ä¸å¥½", "è‡ªæ€", "ç„¦è™‘", "ææ…Œ", "æŠ‘éƒ", "ä¸æƒ³æ´»", "å‹åŠ›å¤§", "å¾ˆç´¯", "ç»æœ›", "æ— åŠ©", "çƒ¦èº",
  "ç—›è‹¦", "å´©æºƒ", "æƒ³å“­", "ä¸å¼€å¿ƒ", "ä¼¤å¿ƒ", "å¤±çœ ", "æ²¡æ„ä¹‰", "æƒ³æ”¾å¼ƒ", "æ²¡äººæ‡‚", "å­¤ç‹¬", "å®³æ€•", "ææƒ§",
  "çƒ¦", "ç´¯", "ä¸æƒ³è¯´è¯", "ä¸æƒ³åŠ¨", "ä¸æƒ³è§äºº", "ä¸æƒ³ä¸Šç­", "ä¸æƒ³ä¸Šå­¦", "æ²¡åŠ¨åŠ›", "æ²¡å¸Œæœ›", "æƒ³æ­»", "æƒ³ç¦»å¼€",
  "çƒ¦é—·", "å¿ƒç´¯", "å¿ƒç—›", "ç»æœ›", "éº»æœ¨", "æ— æ„Ÿ", "æ— èŠ", "æ— åŠ©", "æ— æœ›", "ä¸æƒ³æ´»äº†", "æ’‘ä¸ä½", "æ’‘ä¸ä¸‹å»",
  "æƒ…ç»ªä½è½", "æ¶ˆæ²‰", "éƒé—·", "é—·é—·ä¸ä¹", "èé¡ä¸æŒ¯", "æ²®ä¸§", "æ‚²ä¼¤", "å“€ä¼¤", "æ„è‹¦", "å¤±è½", "ç°å¿ƒ", "å¤±æœ›",
  "æ„¤æ‡‘", "æ¼æ€’", "ç«å¤§", "æš´èº", "ç‹‚èº", "æ€¨æ¨", "åŒæ¶", "æ†æ¨", "åæ„Ÿ", "ä¸æ»¡", "æ°”æ„¤",
  "ç´§å¼ ", "æ‹…å¿§", "å¿§è™‘", "ä¸å®‰", "æ‰‹è¶³æ— æª", "å¿ƒçƒ¦æ„ä¹±", "å¿å¿‘", "æƒŠæ", "éª‡ç„¶", "æ¯›éª¨æ‚šç„¶", "ä¸å¯’è€Œæ —",
  "å¯‚å¯", "å­¤å•", "ç©ºè™š", "å¤±è½", "æ— èŠ", "ç©ºè™š", "è¿·èŒ«", "å½·å¾¨", "å›°æƒ‘",
  "ç–²æƒ«", "ç²¾ç–²åŠ›å°½", "èº«å¿ƒä¿±ç–²", "ç­‹ç–²åŠ›å°½", "è™šå¼±", "ä¹åŠ›", "åŠ›ä¸ä»å¿ƒ", "é€æ”¯",
  "åŒä¸–", "ç”Ÿæ— å¯æ‹", "äº†æ— ç”Ÿè¶£", "è‹Ÿå»¶æ®‹å–˜", "è¡Œå°¸èµ°è‚‰", "è‡ªæˆ‘å¦å®š", "è‡ªæˆ‘æ€€ç–‘", "æ— åœ°è‡ªå®¹", "ç¾æ„§", "å†…ç–š",
  "é€ƒé¿", "èº²é¿", "é€€ç¼©", "ä¸æ•¢é¢å¯¹", "ä¸æ•¢æƒ³", "ä¸æƒ³æ", "å¿˜ä¸æ‰", "æ”¾ä¸ä¸‹", "èµ°ä¸å‡ºæ¥"
];

import request from '../../utils/request.js'

let resizeTimer = null; // ç”¨äºé˜²æŠ–çš„å®šæ—¶å™¨

export default {
	data() {
		return {
			messages: [] as Array<{ content: string; type: 'user' | 'ai'; id: number }>,
			userInput: '',
			keyboardHeight: 0,
			animating: false,
			scrollTop: 0,
			loading: false,
			messageCount: 0,
			showEmotionModal: false,
			sessionId: 'user_' + Date.now(), // ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºå”¯ä¸€çš„ä¼šè¯ID
			lastShowPromptTime: 0, // ä¸Šæ¬¡æç¤ºæƒ…ç»ªæ‰«æçš„æ—¶é—´
			isLandscape: false, // æ˜¯å¦æ¨ªå±ï¼ˆæ°´å¹³æ”¾ç½®ï¼‰
            windowWidth: 0, // çª—å£å®½åº¦
            windowHeight: 0, // çª—å£é«˜åº¦
		}
	},
    onLoad() {
        console.log("é¡µé¢ onLoad: åˆå§‹åŒ–å±å¹•å°ºå¯¸å’Œç›‘å¬å™¨");
        const systemInfo = uni.getSystemInfoSync();
        this.windowWidth = systemInfo.windowWidth;
        this.windowHeight = systemInfo.windowHeight;
        this.checkOrientation();
        // ç›´æ¥åœ¨onLoadä¸­æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        window.addEventListener('resize', this.handleResize);
    },
    onUnload() {
        console.log("é¡µé¢ onUnload: ç§»é™¤å±å¹•å°ºå¯¸ç›‘å¬å™¨");
        window.removeEventListener('resize', this.handleResize);
        if (resizeTimer) {
            clearTimeout(resizeTimer);
        }
    },
	methods: {
        // æ£€æŸ¥æ¨ªç«–å±çŠ¶æ€
        checkOrientation() {
            const isLand = this.windowWidth > this.windowHeight;
            if (this.isLandscape !== isLand) { // åªæœ‰åœ¨çŠ¶æ€æ”¹å˜æ—¶æ‰æ›´æ–°å’Œæ‰“å°
                this.isLandscape = isLand;
                console.log(`å±å¹•æ–¹å‘åˆ‡æ¢åˆ°: ${isLand ? "æ¨ªå±æ¨¡å¼" : "ç«–å±æ¨¡å¼"}`);
            }
        },

        // å¤„ç†å°ºå¯¸å˜åŒ–
        handleResize() {
            console.log("çª—å£å°ºå¯¸å˜åŒ–äº‹ä»¶è§¦å‘");
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const systemInfo = uni.getSystemInfoSync();
                this.windowWidth = systemInfo.windowWidth;
                this.windowHeight = systemInfo.windowHeight;
                console.log(`æ–°çª—å£å°ºå¯¸: å®½åº¦=${this.windowWidth}, é«˜åº¦=${this.windowHeight}`);
                this.checkOrientation();
            }, 100); // é˜²æŠ–å»¶è¿Ÿ
        },
		// æ–°å¢ï¼šæ£€æµ‹æ¶ˆæ¯æ˜¯å¦åŒ…å«è´Ÿé¢å…³é”®è¯
		containsNegativeKeyword(msg) {
			return negativeKeywords.some(word => msg.includes(word));
		},
		// æ–°å¢ï¼šæ£€æµ‹AIå›å¤ä¸­æ˜¯å¦åŒ…å«æƒ…ç»ªæ‰«ææ¨èå…³é”®è¯
		containsAIRecommendedKeyword(response) {
			const promptKeywords = ['æƒ…ç»ªæ‰«æ', 'æƒ…ç»ªåˆ†æ', 'æ£€æµ‹ä½ çš„æƒ…ç»ª', 'å¿ƒç†æ£€æµ‹', 'æƒ…ç»ªæ³¢åŠ¨',
				'æƒ…ç»ªçŠ¶æ€', 'å¿ƒæƒ…å¦‚ä½•', 'å¿ƒç†çŠ¶å†µ', 'éœ€è¦å¸®åŠ©', 'çœ‹èµ·æ¥å¾ˆ', 'å»ºè®®ä½ ', 'ä¼¼ä¹ä½ åœ¨',
				'æˆ–è®¸ä½ éœ€è¦', 'æˆ‘æ„Ÿå—åˆ°ä½ çš„', 'çœ‹èµ·æ¥ä½ å¯èƒ½åœ¨', 'ä½ çš„è¯­æ°”æ˜¾ç¤º', 'è®©æˆ‘ä»¬ä¸€èµ·'
			];
			const emotionWordsInAIResponse = ['ä¼¤å¿ƒ', 'éš¾è¿‡', 'ç„¦è™‘', 'æ‹…å¿§', 'ç”Ÿæ°”', 'æ„¤æ€’', 'ææƒ§',
				'ç´§å¼ ', 'å‹åŠ›', 'å›°æ‰°', 'çƒ¦æ¼', 'æ¶ˆæ', 'æŠ‘éƒ', 'æ‚²è§‚'
			];

			let foundPromptKeyword = promptKeywords.some(keyword => response.includes(keyword));
			let emotionWordCount = emotionWordsInAIResponse.filter(word => response.includes(word)).length;

			return foundPromptKeyword || (emotionWordCount >= 2);
		},

		// ç»Ÿä¸€çš„æƒ…ç»ªæ£€æµ‹è§¦å‘é€»è¾‘
		runComprehensiveEmotionCheck() {
			// ç¡®ä¿è‡³å°‘èŠäº†3å¥ï¼ˆç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤æ€»å’Œï¼‰æ‰å¼€å§‹æ£€æµ‹
			if (this.messageCount < 3) {
				return;
			}

			// æ£€æŸ¥å†·å´æ—¶é—´ï¼Œé¿å…é¢‘ç¹å¼¹çª—ï¼ˆ5åˆ†é’Ÿ = 300000æ¯«ç§’ï¼‰
			if (Date.now() - this.lastShowPromptTime < 300000) {
				return;
			}

			let shouldTriggerModal = false;

			// éå†æ‰€æœ‰æ¶ˆæ¯ï¼ˆç”¨æˆ·å’ŒAIçš„ï¼‰ï¼Œæ£€æµ‹å…³é”®è¯
			// æ³¨æ„ï¼šè¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦ä¼˜åŒ–ï¼Œä¾‹å¦‚åªæ£€æµ‹æœ€è¿‘Næ¡æ¶ˆæ¯
			for (const message of this.messages) {
				if (message.type === 'user') {
					if (this.containsNegativeKeyword(message.content)) {
						shouldTriggerModal = true;
						break; // å‘ç°å…³é”®è¯å³å¯è§¦å‘
					}
				} else if (message.type === 'ai') {
					// å¦‚æœAIå›å¤ä¸­åŒ…å«æƒ…ç»ªç›¸å…³çš„å…³é”®è¯æˆ–AIæ¨èè¯
					if (this.containsAIRecommendedKeyword(message.content)) {
						shouldTriggerModal = true;
						break; // å‘ç°å…³é”®è¯å³å¯è§¦å‘
					}
				}
			}

			if (shouldTriggerModal && !this.showEmotionModal) {
				setTimeout(() => {
					this.showEmotionModal = true;
					this.lastShowPromptTime = Date.now();
				}, 1000); // å»¶è¿Ÿ1ç§’æ˜¾ç¤ºå¼¹çª—ï¼Œæ›´è‡ªç„¶
			}
		},

		// å¤„ç†æ¶ˆæ¯å‘é€
		handleSend() {
			if (!this.userInput.trim() || this.animating || this.loading) return

			const userText = this.userInput.trim()
			this.userInput = ''
			this.animating = true
			this.loading = true

			// æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
			this.messages.push({
				content: userText,
				type: 'user',
				id: Date.now()
			})

			// æ¶ˆæ¯å‘é€åæ»šåŠ¨åˆ°åº•éƒ¨
			this.$nextTick(() => {
				this.scrollToBottom()

				// è°ƒç”¨APIè·å–å›å¤
				this.getAIResponse(userText)

				// å¢åŠ æ¶ˆæ¯è®¡æ•°
				this.messageCount++

				// æ¯æ¬¡ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œè¿è¡Œå…¨é¢çš„æƒ…ç»ªæ£€æµ‹
				this.runComprehensiveEmotionCheck()
			})
		},

		// è°ƒç”¨APIè·å–AIå“åº”
		getAIResponse(userText) {
            console.log('getAIResponse: å¼€å§‹è°ƒç”¨LLM API');
            console.log('å‘é€ç»™LLMçš„userText:', userText);
            console.log('ä½¿ç”¨çš„sessionId:', this.sessionId);

			// æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
			uni.showLoading({
				title: 'åˆ†æä¸­...',
				mask: false
			});

			// ä½¿ç”¨çœŸå®çš„LLM API
			request.chatWithLLM({
				message: userText,
				sessionId: this.sessionId
			})
			.then(res => {
                console.log('LLM APIè°ƒç”¨æˆåŠŸï¼Œæ”¶åˆ°å®Œæ•´å“åº”:', res);
				uni.hideLoading(); // æå‰éšè—loading

				const response = res.response_text;

				if (response) {
					this.messages.push({
						content: response,
						type: 'ai',
						id: Date.now()
					});
					console.log('LLMå“åº”å†…å®¹:', response);
					// AIå›å¤åä¹Ÿè¿›è¡Œå…¨é¢çš„æƒ…ç»ªæ£€æµ‹
					this.runComprehensiveEmotionCheck();
				} else {
					console.warn('LLMå“åº”ä¸­æœªæ‰¾åˆ°response_textæˆ–å…¶ä¸ºç©º:', res);
					uni.showToast({ title: 'AIå“åº”å†…å®¹ä¸ºç©º', icon: 'none', duration: 2000 });
				}
			})
			.catch(err => {
                console.error('LLM APIè°ƒç”¨å¤±è´¥ï¼Œæ•è·åˆ°é”™è¯¯:', err);
				uni.hideLoading(); // æå‰éšè—loading
				// æ‰“å°å®Œæ•´çš„é”™è¯¯å¯¹è±¡ï¼Œç¡®ä¿èƒ½çœ‹åˆ°æ‰€æœ‰ç»†èŠ‚
				console.error('LLMè¯·æ±‚å¤±è´¥çš„å®Œæ•´é”™è¯¯ä¿¡æ¯:', JSON.stringify(err, null, 2)); 
				let errorMessage = 'AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨';
				if (err) {
					if (err.message) {
						errorMessage = err.message;
					}
					// å°è¯•ä»ä¸åŒçš„é”™è¯¯ç»“æ„ä¸­æå–è¯¦ç»†ä¿¡æ¯
					if (err.detail) {
						if (typeof err.detail === 'string') {
							errorMessage += `: ${err.detail}`;
						} else if (err.detail.errMsg) { // é’ˆå¯¹uni.requestçš„errMsg
                            errorMessage += `: ${err.detail.errMsg}`;
                        } else if (Array.isArray(err.detail) && err.detail.length > 0 && err.detail[0].msg) {
							errorMessage += `: ${err.detail[0].msg}`;
						}
					}
				}
				uni.showToast({ title: errorMessage, icon: 'none', duration: 4000 });
			})
			.finally(() => {
                console.log('LLM APIè°ƒç”¨ç»“æŸï¼Œæ‰§è¡Œ finally å—');
				this.$nextTick(() => {
					this.scrollToBottom();
					this.loading = false;
					setTimeout(() => { this.animating = false; }, 300);
				});
			});
		},

		// å¤„ç†è¾“å…¥æ¡†ç‚¹å‡»
		handleInputClick() {
			// ç®€åŒ–çš„è¾“å…¥æ¡†ç‚¹å‡»å¤„ç†ï¼Œæ ¹æ®å®é™…éœ€è¦æ‰©å±•
		},

		// æ»šåŠ¨åˆ°åº•éƒ¨ - ä½¿ç”¨scroll-viewçš„æ»šåŠ¨ç‰¹æ€§
		scrollToBottom() {
			setTimeout(() => {
				const query = uni.createSelectorQuery().in(this)
				query.selectAll('.chat-box view').boundingClientRect(data => {
					if (data && data.length > 0) {
						this.scrollTop = 10000
					}
				}).exec()
			}, 100)
		},

		// å…³é—­æƒ…ç»ªæ£€æµ‹å¼¹çª—
		closeEmotionModal() {
			this.showEmotionModal = false
		},

		// å¼€å§‹æƒ…ç»ªæ£€æµ‹
		startEmotionDetection() {
			this.closeEmotionModal()
			uni.navigateTo({
				url: '/pages/emotion-detect/emotion-detect'
			})
		},
		onSettingTap() {
			uni.showToast({ title: 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...', icon: 'none' });
		}
	}
}
</script>

<style scoped>
.container {
  min-height: 100vh;
  background-color: #050410;
  background-image: linear-gradient(-45deg, #4f00bc, #7d1b7e, #0f0c29, #2a0845, #12c2e9);
  background-size: 400% 400%;
  animation: gradient-bg 12s ease infinite;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 32rpx 0 32rpx 0;
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
  padding-bottom: calc(32rpx + env(safe-area-inset-bottom));
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 30%, rgba(79, 0, 188, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(18, 194, 233, 0.3) 0%, transparent 50%);
  animation: pulse-bg 18s ease-in-out infinite alternate;
  z-index: 0;
  will-change: opacity, transform;
}

/* ç²’å­æ•ˆæœ */
.particles {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
}

.particle {
  position: absolute;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  pointer-events: none;
}

.particle:nth-child(1) { width: 1.5rpx; height: 1.5rpx; top: 10%; left: 20%; animation: float 60s linear infinite; }
.particle:nth-child(2) { width: 3rpx; height: 3rpx; top: 20%; left: 80%; animation: float 45s linear infinite; }
.particle:nth-child(3) { width: 0.8rpx; height: 0.8rpx; top: 30%; left: 15%; animation: float 70s linear infinite; }
.particle:nth-child(4) { width: 2.5rpx; height: 2.5rpx; top: 40%; left: 90%; animation: float 55s linear infinite; }
.particle:nth-child(5) { width: 1.5rpx; height: 1.5rpx; top: 50%; left: 60%; animation: float 80s linear infinite; }
.particle:nth-child(6) { width: 4rpx; height: 4rpx; top: 60%; left: 25%; animation: float 40s linear infinite; }
.particle:nth-child(7) { width: 1.5rpx; height: 1.5rpx; top: 70%; left: 75%; animation: float 65s linear infinite; }
.particle:nth-child(8) { width: 0.8rpx; height: 0.8rpx; top: 80%; left: 35%; animation: float 75s linear infinite; }
.particle:nth-child(9) { width: 2.5rpx; height: 2.5rpx; top: 90%; left: 50%; animation: float 50s linear infinite; }
.particle:nth-child(10) { width: 3rpx; height: 3rpx; top: 15%; left: 65%; animation: float 85s linear infinite; }
.particle:nth-child(11) { width: 1.5rpx; height: 1.5rpx; top: 25%; left: 40%; animation: float 90s linear infinite; }
.particle:nth-child(12) { width: 0.8rpx; height: 0.8rpx; top: 35%; left: 85%; animation: float 60s linear infinite; }
.particle:nth-child(13) { width: 2.5rpx; height: 2.5rpx; top: 45%; left: 5%; animation: float 70s linear infinite; }
.particle:nth-child(14) { width: 1.5rpx; height: 1.5rpx; top: 55%; left: 45%; animation: float 55s linear infinite; }
.particle:nth-child(15) { width: 3rpx; height: 3rpx; top: 65%; left: 95%; animation: float 65s linear infinite; }
.particle:nth-child(16) { width: 2.5rpx; height: 2.5rpx; top: 75%; left: 55%; animation: float 80s linear infinite; }
.particle:nth-child(17) { width: 0.8rpx; height: 0.8rpx; top: 85%; left: 30%; animation: float 45s linear infinite; }
.particle:nth-child(18) { width: 1.5rpx; height: 1.5rpx; top: 95%; left: 70%; animation: float 50s linear infinite; }
.particle:nth-child(19) { width: 3rpx; height: 3rpx; top: 5%; left: 10%; animation: float 75s linear infinite; }
.particle:nth-child(20) { width: 2.5rpx; height: 2.5rpx; top: 93%; left: 13%; animation: float 60s linear infinite; }

@keyframes float {
  0% { transform: translateY(0) translateX(0); }
  50% { transform: translateY(-200px) translateX(100px); }
  100% { transform: translateY(-400px) translateX(0); opacity: 0; }
}

@keyframes gradient-bg {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes pulse-bg {
  0% { opacity: 0.5; }
  50% { opacity: 0.7; }
  100% { opacity: 0.5; }
}

.top-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  margin-top: 36rpx;
  margin-bottom: 36rpx;
  position: relative;
  z-index: 1;
}

.face-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-bottom: 0;
}

.eye {
  width: 80rpx;
  height: 100rpx;
  background: linear-gradient(135deg, #fff, #f0f0f0);
  border-radius: 50% / 100%;
  box-shadow: 0 0 12rpx rgba(255, 255, 255, 0.7);
  animation: eye-blink 6s infinite ease-in-out;
  margin: 0 30rpx;
  position: relative;
  overflow: hidden;
}

@keyframes eye-blink {
  0%, 20%, 40%, 60%, 80%, 100% { transform: scaleY(1); }
  25%, 55%, 85% { transform: scaleY(0.1); }
}

.chat-card {
  width: 96vw;
  max-width: 750rpx;
  min-height: 500rpx;
  background: rgba(255,255,255,0.10);
  border-radius: 32rpx;
  box-shadow: 0 6rpx 32rpx 0 rgba(80,60,180,0.10);
  padding: 20rpx 16rpx 20rpx 16rpx;
  margin: 0 auto 20rpx auto;
  backdrop-filter: blur(8rpx);
  border: 1.5rpx solid rgba(255,255,255,0.13);
  z-index: 1;
}

.chat-box {
  flex: 1;
  width: 100%; /* å æ»¡æ•´ä¸ªå®¹å™¨å®½åº¦ */
  margin: 0; /* ç§»é™¤è¾¹è·ï¼Œè´´è¾¹æ˜¾ç¤º */
  padding: 24rpx; /* å¢åŠ å†…è¾¹è· */
  background-color: rgba(255, 255, 255, 0.1); /* æ·»åŠ èƒŒæ™¯ */
  border-radius: 24rpx; /* åœ†è§’ */
  box-shadow: 0 5rpx 15rpx rgba(0, 0, 0, 0.2); /* é˜´å½± */
  box-sizing: border-box;
  overflow-y: auto;
  min-height: 400rpx; /* è®¾ç½®æœ€å°é«˜åº¦ */
}

.ai-message,
.user-message {
  max-width: 75%; /* å¢åŠ æœ€å¤§å®½åº¦ */
  margin-bottom: 16rpx; /* å¢åŠ åº•éƒ¨è¾¹è· */
  padding: 18rpx 24rpx; /* å¢åŠ å†…è¾¹è· */
  border-radius: 24rpx; /* å¢åŠ åœ†è§’ */
  position: relative;
  animation: message-in 0.3s ease-out forwards;
  word-wrap: break-word;
  display: block;
}

.chat-message {
  font-size: 24rpx;
  line-height: 1.4;
}

.ai-message {
  background-color: rgba(255, 255, 255, 0.1);
  color: #ffffff;
  align-self: flex-start;
  margin-right: auto;
  border-bottom-left-radius: 6rpx; /* è¿›ä¸€æ­¥ç¼©å°åœ†è§’ */
}

.user-message {
  background-color: #6847c2;
  color: #ffffff;
  align-self: flex-end;
  margin-left: auto;
  border-bottom-right-radius: 6rpx; /* è¿›ä¸€æ­¥ç¼©å°åœ†è§’ */
}

/* åŠ è½½æ¶ˆæ¯åŠ¨ç”» */
.loading-message {
  background-color: rgba(255, 255, 255, 0.1);
  color: #ffffff;
  align-self: flex-start;
  margin-right: auto;
  border-bottom-left-radius: 6rpx; /* è¿›ä¸€æ­¥ç¼©å°åœ†è§’ */
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 60rpx; /* è¿›ä¸€æ­¥ç¼©å°æœ€å°é«˜åº¦ */
}

.loading-dots {
  display: flex;
}

.dot {
  width: 12rpx; /* è¿›ä¸€æ­¥ç¼©å°ç‚¹ */
  height: 12rpx; /* è¿›ä¸€æ­¥ç¼©å°ç‚¹ */
  background-color: #fff;
  border-radius: 50%;
  margin: 0 2rpx; /* è¿›ä¸€æ­¥ç¼©å°é—´è· */
  animation: bounce 1.4s infinite ease-in-out;
}

.dot:nth-child(2) {
  animation-delay: 0.2s;
}

.dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}

@keyframes message-in {
  from { opacity: 0; transform: translateY(10rpx); } /* è¿›ä¸€æ­¥ç¼©å°ä½ç§» */
  to { opacity: 1; transform: translateY(0); }
}

.input-card {
  width: 96vw;
  max-width: 750rpx;
  display: flex;
  align-items: center;
  background: rgba(255,255,255,0.10);
  border-radius: 32rpx;
  box-shadow: 0 6rpx 32rpx 0 rgba(80,60,180,0.10);
  padding: 20rpx 16rpx 20rpx 16rpx;
  margin: 0 auto 20rpx auto;
  backdrop-filter: blur(8rpx);
  border: 1.5rpx solid rgba(255,255,255,0.13);
  z-index: 2;
}
.input-inner {
  width: 100%;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
  background: rgba(255,255,255,0.13);
  border-radius: 24rpx;
  padding: 0 18rpx 0 24rpx;
  box-sizing: border-box;
}
.chat-input {
  flex: 1;
  font-size: 32rpx;
  border: none;
  outline: none;
  background: transparent;
  color: #fff;
  padding: 32rpx 0; /* è¿›ä¸€æ­¥å¢åŠ ä¸Šä¸‹å†…è¾¹è· */
  min-height: 72rpx; /* ç›¸åº”å¢åŠ æœ€å°é«˜åº¦ */
  margin-right: 16rpx;
  display: block;
}
.send-button {
  margin-left: 0;
  padding: 0 40rpx;
  height: 56rpx;
  line-height: 56rpx;
  border-radius: 28rpx;
  background: linear-gradient(90deg, #7d1b7e 0%, #4f00bc 100%);
  color: #fff;
  font-weight: 600;
  font-size: 30rpx;
  box-shadow: 0 4rpx 16rpx #4f00bc55;
  transition: all 0.3s ease;
  flex-shrink: 0;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.send-button.disabled {
  opacity: 0.5;
  background: #b0b0c0;
  box-shadow: none;
}

.send-button:active {
  transform: scale(0.95);
  box-shadow: 0 2rpx 8rpx #4f00bc33;
}

.send-button:hover {
  box-shadow: 0 6rpx 20rpx #4f00bc66;
}

.privacy-footer-card {
  width: 96vw;
  max-width: 750rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 18rpx 24rpx;
  margin: 0 auto 0 auto;
  background: rgba(255,255,255,0.10);
  border-radius: 32rpx;
  box-shadow: 0 6rpx 32rpx 0 rgba(80,60,180,0.10);
  border: 1.5rpx solid rgba(255,255,255,0.13);
  z-index: 2;
  position: relative;
}

.fab-setting {
  position: fixed;
  right: 38rpx;
  bottom: 54rpx;
  width: 88rpx;
  height: 88rpx;
  background: linear-gradient(135deg, #4f00bc 0%, #12c2e9 100%);
  border-radius: 50%;
  box-shadow: 0 4rpx 16rpx #4f00bc55;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99;
  cursor: pointer;
  transition: box-shadow 0.2s;
}
.fab-setting:active {
  box-shadow: 0 2rpx 6rpx #4f00bc33;
}
.fab-icon {
  font-size: 44rpx;
  color: #fff;
}

/* æƒ…ç»ªæ£€æµ‹æ¨èå¼¹çª—æ ·å¼ */
.emotion-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.emotion-modal-content {
  background: linear-gradient(135deg, #4f00bc, #7d1b7e);
  border-radius: 20rpx; /* è¿›ä¸€æ­¥ç¼©å°åœ†è§’ */
  padding: 25rpx; /* è¿›ä¸€æ­¥ç¼©å°å†…è¾¹è· */
  width: 90%; /* è¿›ä¸€æ­¥è°ƒæ•´å®½åº¦ */
  max-width: 450rpx; /* è¿›ä¸€æ­¥ç¼©å°æœ€å¤§å®½åº¦ */
  box-shadow: 0 6rpx 20rpx rgba(0, 0, 0, 0.3); /* è¿›ä¸€æ­¥ç¼©å°é˜´å½± */
  text-align: center;
  position: relative;
  animation: modal-fade-in 0.3s ease-out;
}

@keyframes modal-fade-in {
  from { opacity: 0; transform: translateY(-30rpx) scale(0.98); } /* è¿›ä¸€æ­¥ç¼©å°ä½ç§»å’Œç¼©æ”¾ */
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-close {
  position: absolute;
  top: 10rpx; /* è¿›ä¸€æ­¥ç¼©å°ä½ç½® */
  right: 20rpx; /* è¿›ä¸€æ­¥ç¼©å°ä½ç½® */
  font-size: 32rpx; /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
}

.modal-header {
  margin-bottom: 20rpx; /* è¿›ä¸€æ­¥ç¼©å°åº•éƒ¨è¾¹è· */
}

.modal-title {
  font-size: 36rpx; /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
  color: #ffffff;
  font-weight: bold;
}

.modal-body {
  margin-bottom: 25rpx; /* è¿›ä¸€æ­¥ç¼©å°åº•éƒ¨è¾¹è· */
}

.modal-text {
  font-size: 26rpx; /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.3; /* è°ƒæ•´è¡Œé«˜ */
  margin-bottom: 6rpx; /* è¿›ä¸€æ­¥ç¼©å°åº•éƒ¨è¾¹è· */
  display: block;
}

.modal-description {
  font-size: 24rpx; /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
  color: rgba(255, 255, 255, 0.7);
  margin-top: 10rpx; /* è¿›ä¸€æ­¥ç¼©å°é¡¶éƒ¨è¾¹è· */
}

.modal-icon {
  width: 80rpx; /* è¿›ä¸€æ­¥ç¼©å°å›¾æ ‡ */
  height: 80rpx; /* è¿›ä¸€æ­¥ç¼©å°å›¾æ ‡ */
  background-color: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 25rpx auto; /* è¿›ä¸€æ­¥ç¼©å°è¾¹è· */
  position: relative;
}

.modal-icon .pulse-circle {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.3);
  animation: modal-pulse 1.5s infinite;
}

@keyframes modal-pulse {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(1.2); opacity: 0; } /* è¿›ä¸€æ­¥ç¼©å°ç¼©æ”¾ */
}

.modal-footer {
  display: flex;
  justify-content: space-around;
  margin-top: 25rpx; /* è¿›ä¸€æ­¥ç¼©å°é¡¶éƒ¨è¾¹è· */
}

.modal-button {
  padding: 12rpx 25rpx; /* è¿›ä¸€æ­¥ç¼©å°å†…è¾¹è· */
  border-radius: 20rpx; /* è¿›ä¸€æ­¥ç¼©å°åœ†è§’ */
  font-size: 26rpx; /* è¿›ä¸€æ­¥ç¼©å°å­—ä½“ */
  cursor: pointer;
  transition: transform 0.1s ease;
}

.modal-button:active {
  transform: scale(0.95);
}

.modal-button.cancel {
  background-color: rgba(255, 255, 255, 0.2);
  color: #ffffff;
}

.modal-button.primary {
  background-color: #fff;
  color: #6847c2;
}

/* æ ·å¼éƒ¨åˆ† */
.welcome-header {
  width: 96vw;
  max-width: 750rpx;
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  padding: 0;
  margin-bottom: 32rpx;
  z-index: 2;
}
.welcome-card {
  display: flex;
  flex-direction: row;
  align-items: center;
  background: rgba(255,255,255,0.15);
  border-radius: 28rpx;
  box-shadow: 0 6rpx 20rpx 0 rgba(80,60,180,0.15);
  padding: 20rpx 24rpx;
  width: 100%;
  backdrop-filter: blur(10rpx);
  border: 1.5rpx solid rgba(255,255,255,0.2);
}
.welcome-icon {
  font-size: 44rpx;
  margin-right: 18rpx;
  display: flex;
  align-items: center;
  justify-content: center;
}
.welcome-texts {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}
.welcome-title {
  font-size: 32rpx;
  font-weight: bold;
  color: #fff;
  margin-bottom: 8rpx;
}
.welcome-tip {
  font-size: 22rpx;
  color: #b0b0c0;
  font-style: normal;
  letter-spacing: 1rpx;
}

.privacy-icon {
  font-size: 32rpx;
  margin-right: 12rpx;
  color: #ffd700;
}

.privacy-text {
  font-size: 24rpx;
  color: #F8D46D; /* è°ƒæ•´ä¸ºæ›´åé»„çš„é¢œè‰² */
  line-height: 1.4;
}
</style>
